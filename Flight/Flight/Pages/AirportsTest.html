<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>AirportInsertTest</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
    <script src="../Scripts/ajaxCalls.js"></script>

    <script>
        var AirportsData;
        var AirportsCounter = 0;

        var AirlinesData;
        var AirlinesCounter = 0;
    
        $(document).ready(function () {
         // תנסה להפעיל אותם 
        //  GetAirports(); שים לב אתה צריך להוריד את ה // 
        //  GetAirlines(); שים לב אתה צריך להוריד את ה // 
        });

        


        function GetAirports() {
            getAllAirports();
            return false; // the return false will prevent the form from being submitted
            // hence the page will not reload
        }

        function getAllAirports() {

            let airports = "https://api.skypicker.com/locations?type=dump&locale=en-US&location_types=airport&limit=4000&active_only=true&sort=name";
            ajaxCall("GET", airports, "", successAirports, errorAirports);
        }
        function successAirports(data) {
            AirportsData = data.locations;        
            swal("Get Airports json Success!", "", "success");
            AddAllAirport();
        }
        function errorAirports(err) {
            alert("error");
        }

        function AddAllAirport() {   
            var AirportsArr = [];
            for (var k in AirportsData) {

                Airport = { // Note that the name of the fields must be identical to the names of the properties of the object in the server
                    airportID: AirportsData[k].id,
                    airportName: AirportsData[k].name,
                    city: AirportsData[k].city.name,
                    country: AirportsData[k].city.country.name,
                    airportLong: AirportsData[k].location.lon,
                    airportLat: AirportsData[k].location.lat
                };
                AirportsArr.push(Airport);         
            }          
            ajaxCall("POST", "../api/Airports", JSON.stringify(AirportsArr), success, Error);
        }
  
        function success(data) {           
                swal("Added Successfuly!", "Inserted all airports into Database", "success");          
        }
        function Error(err) {
            console.log(err);
        }



        function GetAirlines() {
            getAllAirlines();
            return false; // the return false will prevent the form from being submitted
            // hence the page will not reload
        }
        function getAllAirlines() {

            let airlines = "https://api.skypicker.com/airlines";
            ajaxCall("GET", airlines, "", successAirline, errorAirline);
        }
        function successAirline(data) {
            AirlinesData = data;
            swal("Get Airlines json Success!", "", "success");
            AddAllAirline();
        }
        function errorAirline(err) {
            alert("error");
        }
        function AddAllAirline() {
            var AirlinesArr = [];
            for (var k in AirlinesData) {

                if (AirlinesData[k].type == 'airline')
                {
                    Airline = { // Note that the name of the fields must be identical to the names of the properties of the object in the server
                        airlineID: AirlinesData[k].id,
                        airlineName: AirlinesData[k].name,

                    };
                    AirlinesArr.push(Airline);
                }           
            }
            ajaxCall("POST", "../api/Airlines", JSON.stringify(AirlinesArr), successPostAirline, errorPost);
        } 
        function successPostAirline(data) {         
            swal("Added Successfuly!", "Inserted all Airlines into Database", "success");       
        }
        function errorPost(err) {
            alert("error");
        }

    </script>
</head>
<body>

    <div class="container">
        <form id="pForm">
            <h2>Add Airport</h2>
            <div class="form-group">
                <label for="AirportID">AirportID</label>
                <input type="text" class="form-control" id="AirportID" placeholder="Enter the AirportID" required>
            </div>
            <div class="form-group">
                <label for="AirportName">AirportName</label>
                <input type="text" class="form-control" id="AirportName" placeholder="Enter the AirportName" required>
            </div>
            <div class="form-group">
                <label for="City">City</label>
                <input type="text" class="form-control" id="City" placeholder="Enter the City" required>
            </div>
            <div class="form-group">
                <label for="Country">Country</label>
                <input type="text" class="form-control" id="Country" placeholder="Enter the Country" required>
            </div>
            <div class="form-group">
                <label for="Long">Long</label>
                <input type="text" class="form-control" id="Long" placeholder="Enter the Long" required>
            </div>
            <div class="form-group">
                <label for="Lat">Lat</label>
                <input type="text" class="form-control" id="Lat" placeholder="Enter the Lat" required>
            </div>

            <!--<button class="btn btn-default" id="add">Add</button>-->
            <input type="submit" value="Submit BTN" />
        </form>


          <div id="readMovies">       
                <h2>Read Movies</h2>
                <div class="form-group">
                    <label for="getactor">actor name</label>
                    <input type="text" class="form-control" id="getactor" placeholder="Enter the actor name" required>
                </div>
                <input type="submit" value="Get Movies" />          
            <div id="ph">

            </div>
            </div>
    </div>
</body>
</html>